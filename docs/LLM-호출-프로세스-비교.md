# LLM 호출 비교 표

| 프로세스              | 주요 호출 지점 (TDM)                                                                               | 기본 모델∙ENV 변수                                                                                                                                                                                                                | 토큰 전략                                                                                                                                            | Fallback / 재시도                                                                                                                                              | 컨텍스트 & 프롬프트 구성                                                                                                                             | 출력 / UX 전달                                                                                                                 | 안정성 메모                                                                                                       |
| --------------------- | -------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------- |
| 원문 처리 (Origin)    | `startProfileWorker` → `analyzeDocumentProfile` (`server/agents/profile/profileAgent.ts`)          | `PROFILE_AGENT_MODEL` (`gpt-5` 운영) / `PROFILE_AGENT_VALIDATION_MODEL` (`gpt-5-mini`) / `PROFILE_AGENT_VERBOSITY`, `PROFILE_AGENT_REASONING_EFFORT`                                                                              | 초기 1,600 → truncation 시 1.5~2배 증가, CAP 4,800 (`PROFILE_AGENT_MAX_OUTPUT_TOKENS`, `_CAP`), 입력 20k자 제한 (`PROFILE_AGENT_CONTEXT_CHAR_LIMIT`) | Responses JSON 실패/Incomplete 시 토큰 확장 후 재시도, 그래도 실패하면 fallback 모델 호출                                                                      | 시스템 프롬프트 + JSON Schema(`document_profile_analysis`); 원문 샘플/프로젝트 메타/Project Memory 초기값 포함                                       | DocumentProfile + Project Memory 갱신 → Right Panel 요약, Sidebar 상태                                                         | 파일 추출 실패 방지, 워커 큐로 재시도 관리, 토큰 증액 기록으로 비용 추적                                          |
| 번역 (Translation V2) | BullMQ `translation_v2` 워커 → Draft/Revise 단계 (`translationDraftAgent`, `reviseAgent`)          | Draft: `TRANSLATION_DRAFT_MODEL_V2` (`gpt-5` 운영), Revise: `TRANSLATION_REVISE_MODEL_V2` (`gpt-5` 운영); 각 단계별 Verbosity/Reasoning/토큰 ENV (`*_VERBOSITY_V2`, `*_REASONING_EFFORT_V2`, `*_MAX_OUTPUT_TOKENS_V2`)            | Draft 2,200 → CAP 6,400, Revise 1,400 → CAP 3,600; 길이 초과 시 세그먼트 분할, 후보수(`TRANSLATION_DRAFT_CANDIDATES`)에 따라 배치 조정               | JSON 검증 실패/Truncation 시 토큰 증액, Verbosity/Effort 승격; 응답 빈값/오류 시 fallback 모델 (`*_VALIDATION_MODEL_V2`); 단일 세그먼트 반복 실패 시 작업 중단 | Draft/Revise 모두 JSON Schema 응답(`translation_draft_segments`, `translation_revise_segments`); 입력은 세그먼트 텍스트 + Project Memory + 번역 노트 | Draft/Revise 결과를 `translation_drafts`와 `translation_files`에 저장, UI 번역 진행률과 Proofread/Quality에서 동일 데이터 사용 | Micro-check로 LLM 외 Guard 실행, BullMQ 재시도 + 취소 엔드포인트, `TRANSLATION_V2_DEBUG` 로 세그먼트 디버그       |
| 교정 (Proofreading)   | Proofreading Agent `runGenericWorker` (Quick/Deep) (`server/agents/proofreading/genericWorker.ts`) | `PROOFREADING_MODEL` (`gpt-5`), `PROOFREADING_MODEL_FALLBACK` (`gpt-5-mini`); 티어별 토큰/Verbosity/Effort (`PROOFREAD_QUICK_MAX_OUTPUT_TOKENS`, `PROOFREAD_DEEP_MAX_OUTPUT_TOKENS`, `PROOFREAD*_VERBOSITY`, `PROOFREAD*_EFFORT`) | Quick 800 / Deep 1200 초기 → CAP 2,400; truncation 시 1.5배 증가; `p-limit` 로 동시 실행 제어                                                        | Responses 오류 시 토큰 확장 재시도, 이후 fallback 모델; 서브피처별 독립 재시도/에러 보고, dedupe 로직으로 중복 실행 방지                                       | 공통 시스템 프롬프트 + 서브피처 프롬프트 + Guard/Project Memory; JSON Schema(`proofreading_items_schema_v1`) 강제                                    | NDJSON 이벤트로 `useProofreadAgent`에 전달 → Proofread Activity Feed, Proofread Editor 하이라이트                              | Heartbeat(`VITE_PROOFREAD_HEARTBEAT_MS`)로 워커 정체 감시, `proofread_runs` dedupe, tier별 issue 통계로 품질 추적 |
| 품질 검토 (Quality)   | `evaluateQuality` / `evaluateQualityStream` → `qualityAgent` (`server/agents/qualityAgent.ts`)     | `LITERARY_QA_MODEL` (`gpt-5` 운영), Verbosity/Effort ENV (`LITERARY_QA_MODEL_VERBOSITY`, `_REASONING_EFFORT`), 토큰 설정 (`LITERARY_QA_MAX_OUTPUT_TOKENS`, `_CAP`)                                                                | 초기 12k → CAP 24k; truncation 시 1.5~2배 증액; 청크 크기 3,200자·오버랩 200자 (`LITERARY_QA_CHUNK_SIZE/OVERLAP`); 동시성 `LITERARY_QA_CONCURRENCY`  | 청크 단위 재시도, 오류 시 `chunk-error` 이벤트로 보고; 지속 실패 시 전체 평가 중단 후 에러 반환                                                                | JSON Schema(`evalResponseJsonSchema`) 적용, 시스템 프롬프트에 평가 항목 정의 + SHARED_TRANSLATION_GUIDELINES; 입력은 정렬된 문장 페어·프로젝트 메타  | Sync 응답 또는 NDJSON 스트림 → `useQualityAgent` 진행률/점수 업데이트, UI 그래프/코멘트 표시                                   | chunkStats로 requestId/시도/토큰 로깅, 청크 오버랩으로 맥락 유지, Admin 품질 로그에 토큰 소비 기록                |
